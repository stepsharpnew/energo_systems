## Телеграм-бот для сбора заявок (grammy)

Бот собирает:
- отзывы (`/review`);
- запросы на консультацию (`/consult`);
- заявки на услуги (`/service`);
и рассылает их в указанные Telegram-аккаунты/чаты.

Доступ к боту ограничен по списку разрешённых Telegram user ID.

### Настройка окружения

Создайте файл `.env` в папке `tg_bot` рядом с `package.json` и пропишите:

```env
BOT_TOKEN=ваш_токен_бота_из_BotFather

# Список Telegram user ID, которым разрешён доступ к этому боту (через запятую)
ALLOWED_USER_IDS=123456789,987654321

# Чаты/аккаунты, куда бот будет отправлять собранные заявки.
# Если не указано, будет использовано значение ALLOWED_USER_IDS.
ADMIN_CHAT_IDS=123456789,987654321
```

Как узнать свой Telegram user ID:
- можно использовать любого бота для определения ID (например, `@userinfobot`), либо логировать `ctx.from.id` в консоль.

### Установка зависимостей

Из корня проекта:

```bash
cd /home/user/Документы/energo_systems/tg_bot
npm install
```

(Если вы уже запускали `npm install`, этот шаг можно пропустить.)

### Запуск бота

```bash
cd /home/user/Документы/energo_systems/tg_bot
npm start
```

При успешном запуске в консоли появится строка:

```text
Бот запущен как @username_бота
```

### Логика работы

- Бот принимает команды:
  - `/start` — краткая справка и список команд;
  - `/review` — диалог по шагам для сбора отзыва (имя → контакт → текст отзыва);
  - `/consult` — диалог для запроса консультации (имя → контакт → вопрос);
  - `/service` — диалог для заявки на услугу (имя → контакт → услуга → доп. информация);
  - `/cancel` — сброс текущего диалога.
- После завершения любого сценария бот формирует текст и рассылает его во все ID из `ADMIN_CHAT_IDS` (или `ALLOWED_USER_IDS`, если `ADMIN_CHAT_IDS` не указан).
- Доступ к боту:
  - если `ALLOWED_USER_IDS` задан, бот принимает команды только от этих user ID;
  - остальным пользователям отвечает текстом: «У вас нет доступа к этому боту.»


